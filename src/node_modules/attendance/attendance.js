let models = require('sql-models');


let FunctionList = {

 async markAttendance(object){
     return await models.db.employee_attendance.create(object);
 },
 async dayWise(object){
     let startdate=object.start_date
     let enddate=object.end_date
     let employeeid=object.employee_id
     let sql="SELECT DATE(attendance_date) as 'date',TIME_FORMAT(time_in, '%h:%i %p' ) as 'time_in', TIME_FORMAT(time_out, '%h:%i %p' ) as 'time_out', HOUR(TIMEDIFF(time_out, time_in)) as 'Hrs' ,attendance_code from employee_attendance where attendance_date between "+startdate+ " and "+ enddate +" and employee_id=" + employeeid
     return await models.db.sequelize.query(sql);
 },
 async Summary(object){
     let startdate=object.start_date
     let enddate=object.end_date
     let employeeid = object.employee_id
     sql ="select (select count(*) from employee_attendance where attendance_date between "+startdate+ " and "+ enddate +" and attendance_code='P' and employee_id="+employeeid+") as 'Present',(select count(*) from employee_attendance where attendance_code='A' and employee_id="+employeeid+") as 'Absent',(select count(*) from employee_attendance where attendance_code='O' and employee_id="+employeeid+") as 'Off'"
     return await models.db.sequelize.query(sql);
 },
 async hourlySummary(object){
     let startdate=object.start_date
     let enddate=object.end_date
     let employeeid = object.employee_id
     sql ="SELECT SUM(HOUR(TIMEDIFF(time_out,time_in))) AS 'totalHour' from employee_attendance where attendance_date between "+startdate+ " and "+ enddate +" and attendance_code='P' and  employee_id="+employeeid
     total= await models.db.sequelize.query(sql);

     sql ="SELECT AVG(HOUR(TIMEDIFF(time_out,time_in))) AS 'avgHour' from employee_attendance where attendance_date between "+startdate+ " and "+ enddate +" and attendance_code='P' and  employee_id="+employeeid
     avg= await models.db.sequelize.query(sql);

     sql ="SELECT SUM(HOUR(TIMEDIFF(time_out,time_in))-12) AS 'extraHour' from employee_attendance where attendance_date between "+startdate+ " and "+ enddate +" and attendance_code='P' and HOUR(TIMEDIFF(time_out,time_in))>12 and employee_id="+employeeid
     extra= await models.db.sequelize.query(sql);

     sql ="SELECT SUM(HOUR(TIMEDIFF(time_out,time_in))) AS 'lessHour' from employee_attendance where attendance_date between "+startdate+ " and "+ enddate +" and attendance_code='P' and HOUR(TIMEDIFF(time_out,time_in))<8 and employee_id="+employeeid
     less= await models.db.sequelize.query(sql);

     let hourlySummary={"Total Hours":total[0][0].totalHour, "Average Hours":avg[0][0].avgHour , "More than 12 hrs":extra[0][0].extraHour, "Less than 8 hrs":less [0][0].lessHour }
     return hourlySummary
 },




};

exports.fun = FunctionList;
