var Excel = require('exceljs');
module.exports = {
  async download_excel(args){
    // let timestamp = new Date().getTime()
    let filename = args.filename;
    let data = args.data || [];
    let workbook = new Excel.Workbook();
    workbook.views = [
      {
        x: 0, y: 0, width: 10000, height: 20000,
        firstSheet: 0, activeTab: 1, visibility: 'visible'
      }
    ];
    let worksheet = workbook.addWorksheet('Sheet1', {views:[{xSplit: 1, ySplit:1}]});
    worksheet.columns = args.columns;
     // Add Header Style
     var header_style = {
       font: { },
       fill: { type: 'pattern', pattern: 'lightGray',}
     };
     var editing_style = {
       font: {},
       fill: { type: 'pattern', pattern:'darkTrellis',
        fgColor:{argb:'FFFFFF00'},
        bgColor:{argb:'88FFFFE0'}} //FF0000FF
     }
     for(var i=1; i <= worksheet.columns.length; i++){
       var cell = worksheet.getCell(1,i);
       cell.font = header_style.font;
       cell.fill = header_style.fill;
     }
     for(var i=0; i < data.length; i++){
       worksheet.addRow(data[i]);
     }
    //  var validations = args.validations;
    //  console.log(filename)
      return await workbook.xlsx.writeFile(filename)
      // .then(function() {
      //     console.log('Generated File: ' + filename);
      //     args.complete(filename);
      // });
    }
}
