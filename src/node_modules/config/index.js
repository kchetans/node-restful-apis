/**
 * Created by Kartik Agarwal.
 */
const Nconf = require('nconf');
const validateConfig = require('./validate-config');
const path = require('path');
const nconf = new Nconf.Provider();
const default_env = 'development';
let env = process.env.NODE_ENV;
let chalk = require('chalk');


// setup default_env if variable is not a valid parameter.
if (!env) {
    env = default_env;
}
console.log(chalk.blue("Env file is " + env));


/**
 * command line arguments
 */
nconf.argv();

/**
 * env arguments
 */
nconf.env({
    separator: '__'
});

let ROOT_PATH = path.join(__dirname);

/**
 * load config files
 */
nconf.file('overrides', path.join(ROOT_PATH, 'overrides.json'));
nconf.file('environment', path.join(ROOT_PATH, 'env', 'config.' + env + '.json'));
nconf.file('defaults', path.join(ROOT_PATH, 'defaults.json'));

/**
 * values we have to set manual
 */
nconf.set('env', env);

const nval = require('nconf-validator')(nconf);
validateConfig.addRules(nval);
nval.validate();


module.exports = nconf;
