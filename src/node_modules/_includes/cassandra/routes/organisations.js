/**
 * Created by mysterio86 on 18/3/17.
 */
var express = require('express');
var router = express.Router();
var organisations = require('../modules/organisations');
var organisation_units = require('../modules/organisation_units');
var organisation_entities = require('../modules/organisation_structure');
var organisation_positions = require('../modules/organisation_units_positions');
var organisation_employees = require('../modules/organisation_employes');
// var connection_string = require('../cs_db').cass_connection();

var sendJsonResponse = function (res, status, content) {
    res.status(status);
    res.json(content);
};

router.get('/org/test', function (req, res, next) {
    sendJsonResponse(res, '200', 'I m in organisations');
});

// router.get('/org', function (req, res) {
//         connection_string.instance.Person.findOne({name: 'Mary'}, function (err, john) {
//             if (err) {
//                 console.log(err);
//                 sendJsonResponse(res, '200', err.message);
//                 return;
//             }
//             //Note that returned variable john here is an instance of your model,
//             //so you can also do john.delete(), john.save() type operations on the instance.
//             console.log('Found ' + john.name + ' to be ' + john.age + ' years old!');
//             // console.log(connection_string);
//             sendJsonResponse(res, '200', john);
//         });
//
//         console.log("Oranisation ", connection_string.timeuuidFromString('fe615100-0b96-11e7-90c0-d3f48f3ff6b5'));
//         connection_string.instance.Organisations.findOne({
//             org_id: connection_string.timeuuidFromString('fe615100-0b96-11e7-90c0-d3f48f3ff6b5')
//         }, function (err, result) {
//             if (err) {
//                 console.log(err);
//                 return;
//             }
//             console.log('name of the organisation :' + result.org_name);
//         });
//
//         connection_string.instance.Person.find({}, function(err, people){
//             if(err) throw err;
//             //people is an array of model instances containing the persons with name `John`
//             people.forEach(function (person, index) {
//                 console.log('Found {0}',index, person.name);
//             })
//         });
//
//     }
// );

/*routes for the organisations table*/
router.post('/org/create', organisations.createOrganisation);
router.get('/org/', organisations.getAllOrganisations);
router.get('/org/active', organisations.getAllActiveOrganisations);
router.get('/org/id/:org_id', organisations.getOrganisationById);
router.get('/org/code/:org_code', organisations.getOrganisationByCode);
router.put('/org/code/:org_code/disable', organisations.deleteOrganisationByCode);
router.put('/org/code/:org_code/enable', organisations.activateOrganisationByCode);

/*routes for the organisation unit table*/
router.get('/org/:org_id/ou', organisation_units.getAllOrganisationUnits);
router.get('/org/:org_id/ou/active', organisation_units.getAllActiveOrganisationUnits);
router.post('/org/:org_id/ou/create', organisation_units.createOrganisationUnit);
router.put('/org/:org_id/:ou_code/disable', organisation_units.deleteOrganisationUnitByCode);
router.put('/org/:org_id/:ou_code/enable', organisation_units.enableOrganisationUnitByCode);

/*routes for the organisation structure table*/
router.post('/org/:org_id/ent/:ou_code/create', organisation_entities.createOrganisationEntity);
router.get('/org/:org_id/ent', organisation_entities.getAllOrganisationEntities);

router.post('/org/:org_id/pos/:ou_id/create', organisation_positions.createOrganisationUnitPositions);
router.get('/org/:org_id/pos', organisation_positions.getOrganisationPositions);

router.post('/org/:org_id/emp/:ou_ent_id/create', organisation_employees.createOrganisationEntityEmployee);
router.get('/org/:org_id/emp/:ou_ent_id', organisation_employees.getOrganisationEntityEmployees);

module.exports = router;